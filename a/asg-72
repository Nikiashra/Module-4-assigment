import 'dart:async';
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';

void main()
{
  runApp( const MyApp());
}
class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return const MaterialApp(
      title: "Call Permission",
      debugShowCheckedModeBanner: false,
      home: CallPage(),
    );

  }
}

class CallPage extends StatefulWidget {
  const CallPage({super.key});

  @override
  State<CallPage> createState() => _CallPageState();
}

class _CallPageState extends State<CallPage> {
  @override
  void initState() {
    super.initState();
    _requestCallPermission();
  }

  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
          title: const Text("Call App")

      ),
      body: const Center(
        child: Text("Make Call Permission"),
      ),
    );
  }

  Future <void> _requestCallPermission() async
  {
    var status = await Permission.phone.request();
    if (status.isGranted)
    {

    }
    else if(status.isDenied)
      {
        showDialog(context: context,
          builder:(BuildContext context) => AlertDialog(
               title: const Text('Permission Required'),

                content: const Text('This App Required Call Permission'),
                actions: <Widget>[
                  TextButton(onPressed: ()=> Navigator.of(context).pop(),
                      child: const Text('Deny'),),
                  TextButton(
                    onPressed: () {
                      // Open app settings
                      openAppSettings();
                    },
                    child: const Text('Allow in Settings'),
                  ),


                ],
            ),
        );

      }
  }

}
